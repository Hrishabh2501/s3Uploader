{"version":3,"file":"index.es.js","sources":["../src/event-manager.ts","../node_modules/style-inject/dist/style-inject.es.js","../src/icon.tsx","../src/toast.tsx","../src/index.tsx"],"sourcesContent":["type Fn = (data?: any) => void;\n\ninterface Event {\n  key: number;\n  callback: Fn;\n}\n\nclass EventManager {\n  events: {\n    [key: string]: Event[];\n  } = {};\n\n  subscribe(name: string, callback: Fn): number {\n    if (!this.events[name]) {\n      this.events[name] = [];\n    }\n    const event = { key: Date.now(), callback };\n    this.events[name].push(event);\n    return event.key;\n  }\n\n  publish(name: string, data?: any): void {\n    if (this.events[name]) {\n      this.events[name].forEach(({ callback }): void => {\n        callback(data);\n      });\n    }\n  }\n\n  unSubscribe(name: string, key: number): void {\n    if (this.events[name]) {\n      for (let i = 0; i < this.events[name].length; i++) {\n        if (key === this.events[name][i].key) {\n          this.events[name].splice(i, 1);\n          break;\n        }\n      }\n    }\n  }\n}\n\nconst eventManager = new EventManager();\n\nexport default eventManager;\n","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import React from 'react';\nimport { Type } from './types';\nimport { ReactComponent as Success } from './svg/check.svg';\nimport { ReactComponent as Loading } from './svg/loading.svg';\nimport { ReactComponent as Fail } from './svg/close.svg';\nimport styles from './style.css';\n\nconst icons = {\n  fail: <Fail fill=\"#fff\"></Fail>,\n  loading: <Loading fill=\"#fff\" className={styles.loading}></Loading>,\n  success: <Success fill=\"#fff\"></Success>,\n};\n\nexport default function Icon({ type }: { type: Type }): React.ReactElement {\n  return icons[type];\n}\n","import React, { useEffect, useState, useRef } from 'react';\nimport { Type, NoArgsReturnVoidFunction } from './types';\nimport Icon from './icon';\nimport eventManager from './event-manager';\nimport styles from './style.css';\n\nlet timerId = -1;\n\nfunction debounce(\n  callback: NoArgsReturnVoidFunction\n): NoArgsReturnVoidFunction {\n  let count = 0;\n  return (): void => {\n    if (count === 0) {\n      callback();\n      count++;\n    }\n  };\n}\n\ntype Props = {\n  type: Type;\n  content: string;\n  duration?: number;\n  onClose: NoArgsReturnVoidFunction;\n};\n\nconst Toast = ({\n  type,\n  content,\n  duration = 3000,\n  onClose,\n}: Props): React.ReactElement => {\n  const [classes, setClasses] = useState(styles.box);\n  const ref = useRef<HTMLDivElement>(null);\n\n  function exit(): void {\n    setClasses((): string => `${styles.box} ${styles.exit}`);\n  }\n\n  useEffect((): NoArgsReturnVoidFunction => {\n    // force a repaint\n    /* eslint-disable no-unused-expressions */\n    ref.current && ref.current.scrollTop;\n    /* eslint-disable no-unused-expressions */\n    setClasses((prev): string => `${prev} ${styles.enter}`);\n    const key = eventManager.subscribe('exit', exit);\n\n    return (): void => {\n      eventManager.unSubscribe('exit', key);\n      window.clearTimeout(timerId); // in case toast unmount before reaching the timeout\n    };\n  }, []);\n\n  const scheduleExit = debounce((): void => {\n    timerId = window.setTimeout(exit, duration);\n  });\n\n  return (\n    <div className={styles.mask}>\n      <div\n        className={classes}\n        style={type === 'info' ? undefined : { padding: 15, borderRadius: 5 }}\n        onTransitionEnd={(): void => {\n          // enter phase\n          if (~classes.indexOf(styles.enter) && duration !== 0) {\n            scheduleExit();\n          }\n\n          // exit phase\n          if (~classes.indexOf(styles.exit)) {\n            onClose();\n          }\n        }}\n        ref={ref}\n      >\n        {type !== 'info' && (\n          <div\n            className={styles.wrapper}\n            style={type === 'loading' ? { marginBottom: 10 } : undefined}\n          >\n            <Icon type={type}></Icon>\n          </div>\n        )}\n        <span className={styles.message}>{content}</span>\n      </div>\n    </div>\n  );\n};\n\nexport default Toast;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Type, NoArgsReturnVoidFunction } from './types';\nimport eventManager from './event-manager';\nimport Toast from './toast';\n\ninterface Message {\n  type: Type;\n  content: string;\n  duration?: number;\n  onClose?: NoArgsReturnVoidFunction;\n}\n\n// save messages in a queue, only remove it when component lifecycle ends\nconst messages: Message[] = [];\n\neventManager.subscribe('popmessage', (): void => {\n  const { type, content, duration, onClose } = messages[0];\n  const container = document.createElement('div');\n  document.body.appendChild(container);\n  ReactDOM.render(\n    <Toast\n      type={type}\n      content={content}\n      duration={duration}\n      onClose={(): void => {\n        ReactDOM.unmountComponentAtNode(container);\n        document.body.removeChild(container);\n        onClose && onClose();\n        messages.shift();\n        if (messages.length > 0) {\n          eventManager.publish('popmessage');\n        }\n      }}\n    ></Toast>,\n    container\n  );\n});\n\nfunction notice(\n  type: Type,\n  content: string,\n  duration?: number,\n  onClose?: NoArgsReturnVoidFunction\n): void {\n  messages.push({ type, content, duration, onClose });\n  if (messages.length === 1) {\n    eventManager.publish('popmessage');\n  }\n  // if current message is loading, then we should unmount it to proceed\n  if (messages.length > 1 && messages[0].type === 'loading') {\n    eventManager.publish('exit');\n  }\n}\n\nexport default {\n  info(\n    content: string,\n    duration?: number,\n    onClose?: NoArgsReturnVoidFunction\n  ): void {\n    notice('info', content, duration, onClose);\n  },\n  success(\n    content: string,\n    duration?: number,\n    onClose?: NoArgsReturnVoidFunction\n  ): void {\n    notice('success', content, duration, onClose);\n  },\n  fail(\n    content: string,\n    duration?: number,\n    onClose?: NoArgsReturnVoidFunction\n  ): void {\n    notice('fail', content, duration, onClose);\n  },\n  loading(content: string, onClose?: NoArgsReturnVoidFunction): void {\n    notice('loading', content, 0, onClose);\n  },\n  hide(): void {\n    if (messages.length > 0) {\n      eventManager.publish('exit');\n    }\n  },\n};\n"],"names":["Fail","Loading","Success"],"mappings":"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"}