{"ast":null,"code":"import React, { useState, useRef, useEffect } from 'react';\nimport ReactDOM from 'react-dom';\n\nvar EventManager =\n/** @class */\nfunction () {\n  function EventManager() {\n    this.events = {};\n  }\n\n  EventManager.prototype.subscribe = function (name, callback) {\n    if (!this.events[name]) {\n      this.events[name] = [];\n    }\n\n    var event = {\n      key: Date.now(),\n      callback: callback\n    };\n    this.events[name].push(event);\n    return event.key;\n  };\n\n  EventManager.prototype.publish = function (name, data) {\n    if (this.events[name]) {\n      this.events[name].forEach(function (_a) {\n        var callback = _a.callback;\n        callback(data);\n      });\n    }\n  };\n\n  EventManager.prototype.unSubscribe = function (name, key) {\n    if (this.events[name]) {\n      for (var i = 0; i < this.events[name].length; i++) {\n        if (key === this.events[name][i].key) {\n          this.events[name].splice(i, 1);\n          break;\n        }\n      }\n    }\n  };\n\n  return EventManager;\n}();\n\nvar eventManager = new EventManager();\n\nfunction _extends() {\n  _extends = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends.apply(this, arguments);\n}\n\nvar _ref = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M512 896c-212.064 0-384-171.936-384-384s171.936-384 384-384 384 171.936 384 384-171.936 384-384 384m0-832C264.96 64 64 264.96 64 512s200.96 448 448 448 448-200.96 448-448S759.04 64 512 64\"\n});\n\nvar _ref2 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M432 618.752L310.624 497.376l-45.248 45.248L432 709.248l326.624-326.624-45.248-45.248z\"\n});\n\nvar SvgCheck = function SvgCheck(props) {\n  return React.createElement(\"svg\", _extends({\n    viewBox: \"0 0 1024 1024\"\n  }, props), _ref, _ref2);\n};\n\nfunction _extends$1() {\n  _extends$1 = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends$1.apply(this, arguments);\n}\n\nvar _ref$1 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M988 548c-19.9 0-36-16.1-36-36 0-59.4-11.6-117-34.6-171.3a440.45 440.45 0 00-94.3-139.9 437.71 437.71 0 00-139.9-94.3C629 83.6 571.4 72 512 72c-19.9 0-36-16.1-36-36s16.1-36 36-36c69.1 0 136.2 13.5 199.3 40.3C772.3 66 827 103 874 150c47 47 83.9 101.8 109.7 162.7 26.7 63.1 40.2 130.2 40.2 199.3.1 19.9-16 36-35.9 36z\"\n});\n\nvar SvgLoading = function SvgLoading(props) {\n  return React.createElement(\"svg\", _extends$1({\n    viewBox: \"0 0 1024 1024\"\n  }, props), _ref$1);\n};\n\nfunction _extends$2() {\n  _extends$2 = Object.assign || function (target) {\n    for (var i = 1; i < arguments.length; i++) {\n      var source = arguments[i];\n\n      for (var key in source) {\n        if (Object.prototype.hasOwnProperty.call(source, key)) {\n          target[key] = source[key];\n        }\n      }\n    }\n\n    return target;\n  };\n\n  return _extends$2.apply(this, arguments);\n}\n\nvar _ref$2 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M512 896c-212.064 0-384-171.936-384-384s171.936-384 384-384 384 171.936 384 384-171.936 384-384 384m0-832C264.96 64 64 264.96 64 512s200.96 448 448 448 448-200.96 448-448S759.04 64 512 64\"\n});\n\nvar _ref2$1 = /*#__PURE__*/React.createElement(\"path\", {\n  d: \"M665.376 313.376L512 466.752 358.624 313.376l-45.248 45.248L466.752 512 313.376 665.376l45.248 45.248L512 557.248l153.376 153.376 45.248-45.248L557.248 512l153.376-153.376z\"\n});\n\nvar SvgClose = function SvgClose(props) {\n  return React.createElement(\"svg\", _extends$2({\n    viewBox: \"0 0 1024 1024\"\n  }, props), _ref$2, _ref2$1);\n};\n\nfunction styleInject(css, ref) {\n  if (ref === void 0) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') {\n    return;\n  }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nvar css = \".style_mask__9zmSN{position:fixed;top:0;right:0;bottom:0;left:0;display:flex;align-items:center;justify-content:center;background:transparent;z-index:1999}.style_box__2iia4{display:inline-block;max-width:85%;min-width:95px;padding:9px 15px;box-sizing:border-box;text-align:center;word-break:break-all;white-space:pre-wrap;font-size:0;color:#fff;background-color:rgba(58,58,58,.9);border-radius:3px;opacity:0;-webkit-transform:scale(.9);transform:scale(.9);-webkit-backface-visibility:hidden;backface-visibility:hidden;-webkit-transition:opacity .3s,-webkit-transform .3s;transition:opacity .3s,-webkit-transform .3s;transition:opacity .3s,transform .3s;transition:opacity .3s,transform .3s,-webkit-transform .3s}.style_enter__29LyQ{opacity:1;-webkit-transform:scale(1);transform:scale(1)}.style_exit__3WYmp{opacity:0;-webkit-transform:scale(.9);transform:scale(.9)}.style_message__1DUXc{line-height:1.5;font-size:14px}.style_wrapper__cQFyX{margin:0 auto 7px;width:36px;height:36px}.style_loading__2pb7J{-webkit-animation:style_loading__2pb7J 1s linear infinite;animation:style_loading__2pb7J 1s linear infinite}@-webkit-keyframes style_loading__2pb7J{to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}@keyframes style_loading__2pb7J{to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}\";\nvar styles = {\n  \"-webkit-mask\": \"style_mask__9zmSN\",\n  \"mask\": \"style_mask__9zmSN\",\n  \"box\": \"style_box__2iia4\",\n  \"enter\": \"style_enter__29LyQ\",\n  \"exit\": \"style_exit__3WYmp\",\n  \"message\": \"style_message__1DUXc\",\n  \"wrapper\": \"style_wrapper__cQFyX\",\n  \"loading\": \"style_loading__2pb7J\"\n};\nstyleInject(css);\nvar icons = {\n  fail: React.createElement(SvgClose, {\n    fill: \"#fff\"\n  }),\n  loading: React.createElement(SvgLoading, {\n    fill: \"#fff\",\n    className: styles.loading\n  }),\n  success: React.createElement(SvgCheck, {\n    fill: \"#fff\"\n  })\n};\n\nfunction Icon(_a) {\n  var type = _a.type;\n  return icons[type];\n}\n\nvar timerId = -1;\n\nfunction debounce(callback) {\n  var count = 0;\n  return function () {\n    if (count === 0) {\n      callback();\n      count++;\n    }\n  };\n}\n\nvar Toast = function (_a) {\n  var type = _a.type,\n      content = _a.content,\n      _b = _a.duration,\n      duration = _b === void 0 ? 3000 : _b,\n      onClose = _a.onClose;\n\n  var _c = useState(styles.box),\n      classes = _c[0],\n      setClasses = _c[1];\n\n  var ref = useRef(null);\n\n  function exit() {\n    setClasses(function () {\n      return styles.box + \" \" + styles.exit;\n    });\n  }\n\n  useEffect(function () {\n    // force a repaint\n\n    /* eslint-disable no-unused-expressions */\n    ref.current && ref.current.scrollTop;\n    /* eslint-disable no-unused-expressions */\n\n    setClasses(function (prev) {\n      return prev + \" \" + styles.enter;\n    });\n    var key = eventManager.subscribe('exit', exit);\n    return function () {\n      eventManager.unSubscribe('exit', key);\n      window.clearTimeout(timerId); // in case toast unmount before reaching the timeout\n    };\n  }, []);\n  var scheduleExit = debounce(function () {\n    timerId = window.setTimeout(exit, duration);\n  });\n  return React.createElement(\"div\", {\n    className: styles.mask\n  }, React.createElement(\"div\", {\n    className: classes,\n    style: type === 'info' ? undefined : {\n      padding: 15,\n      borderRadius: 5\n    },\n    onTransitionEnd: function () {\n      // enter phase\n      if (~classes.indexOf(styles.enter) && duration !== 0) {\n        scheduleExit();\n      } // exit phase\n\n\n      if (~classes.indexOf(styles.exit)) {\n        onClose();\n      }\n    },\n    ref: ref\n  }, type !== 'info' && React.createElement(\"div\", {\n    className: styles.wrapper,\n    style: type === 'loading' ? {\n      marginBottom: 10\n    } : undefined\n  }, React.createElement(Icon, {\n    type: type\n  })), React.createElement(\"span\", {\n    className: styles.message\n  }, content)));\n}; // save messages in a queue, only remove it when component lifecycle ends\n\n\nvar messages = [];\neventManager.subscribe('popmessage', function () {\n  var _a = messages[0],\n      type = _a.type,\n      content = _a.content,\n      duration = _a.duration,\n      onClose = _a.onClose;\n  var container = document.createElement('div');\n  document.body.appendChild(container);\n  ReactDOM.render(React.createElement(Toast, {\n    type: type,\n    content: content,\n    duration: duration,\n    onClose: function () {\n      ReactDOM.unmountComponentAtNode(container);\n      document.body.removeChild(container);\n      onClose && onClose();\n      messages.shift();\n\n      if (messages.length > 0) {\n        eventManager.publish('popmessage');\n      }\n    }\n  }), container);\n});\n\nfunction notice(type, content, duration, onClose) {\n  messages.push({\n    type: type,\n    content: content,\n    duration: duration,\n    onClose: onClose\n  });\n\n  if (messages.length === 1) {\n    eventManager.publish('popmessage');\n  } // if current message is loading, then we should unmount it to proceed\n\n\n  if (messages.length > 1 && messages[0].type === 'loading') {\n    eventManager.publish('exit');\n  }\n}\n\nvar index = {\n  info: function (content, duration, onClose) {\n    notice('info', content, duration, onClose);\n  },\n  success: function (content, duration, onClose) {\n    notice('success', content, duration, onClose);\n  },\n  fail: function (content, duration, onClose) {\n    notice('fail', content, duration, onClose);\n  },\n  loading: function (content, onClose) {\n    notice('loading', content, 0, onClose);\n  },\n  hide: function () {\n    if (messages.length > 0) {\n      eventManager.publish('exit');\n    }\n  }\n};\nexport default index;","map":{"version":3,"sources":["../src/event-manager.ts","../node_modules/style-inject/dist/style-inject.es.js","../src/icon.tsx","../src/toast.tsx","../src/index.tsx"],"names":["Fail","Loading","Success"],"mappings":"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","sourcesContent":["type Fn = (data?: any) => void;\n\ninterface Event {\n  key: number;\n  callback: Fn;\n}\n\nclass EventManager {\n  events: {\n    [key: string]: Event[];\n  } = {};\n\n  subscribe(name: string, callback: Fn): number {\n    if (!this.events[name]) {\n      this.events[name] = [];\n    }\n    const event = { key: Date.now(), callback };\n    this.events[name].push(event);\n    return event.key;\n  }\n\n  publish(name: string, data?: any): void {\n    if (this.events[name]) {\n      this.events[name].forEach(({ callback }): void => {\n        callback(data);\n      });\n    }\n  }\n\n  unSubscribe(name: string, key: number): void {\n    if (this.events[name]) {\n      for (let i = 0; i < this.events[name].length; i++) {\n        if (key === this.events[name][i].key) {\n          this.events[name].splice(i, 1);\n          break;\n        }\n      }\n    }\n  }\n}\n\nconst eventManager = new EventManager();\n\nexport default eventManager;\n","function styleInject(css, ref) {\n  if ( ref === void 0 ) ref = {};\n  var insertAt = ref.insertAt;\n\n  if (!css || typeof document === 'undefined') { return; }\n\n  var head = document.head || document.getElementsByTagName('head')[0];\n  var style = document.createElement('style');\n  style.type = 'text/css';\n\n  if (insertAt === 'top') {\n    if (head.firstChild) {\n      head.insertBefore(style, head.firstChild);\n    } else {\n      head.appendChild(style);\n    }\n  } else {\n    head.appendChild(style);\n  }\n\n  if (style.styleSheet) {\n    style.styleSheet.cssText = css;\n  } else {\n    style.appendChild(document.createTextNode(css));\n  }\n}\n\nexport default styleInject;\n","import React from 'react';\nimport { Type } from './types';\nimport { ReactComponent as Success } from './svg/check.svg';\nimport { ReactComponent as Loading } from './svg/loading.svg';\nimport { ReactComponent as Fail } from './svg/close.svg';\nimport styles from './style.css';\n\nconst icons = {\n  fail: <Fail fill=\"#fff\"></Fail>,\n  loading: <Loading fill=\"#fff\" className={styles.loading}></Loading>,\n  success: <Success fill=\"#fff\"></Success>,\n};\n\nexport default function Icon({ type }: { type: Type }): React.ReactElement {\n  return icons[type];\n}\n","import React, { useEffect, useState, useRef } from 'react';\nimport { Type, NoArgsReturnVoidFunction } from './types';\nimport Icon from './icon';\nimport eventManager from './event-manager';\nimport styles from './style.css';\n\nlet timerId = -1;\n\nfunction debounce(\n  callback: NoArgsReturnVoidFunction\n): NoArgsReturnVoidFunction {\n  let count = 0;\n  return (): void => {\n    if (count === 0) {\n      callback();\n      count++;\n    }\n  };\n}\n\ntype Props = {\n  type: Type;\n  content: string;\n  duration?: number;\n  onClose: NoArgsReturnVoidFunction;\n};\n\nconst Toast = ({\n  type,\n  content,\n  duration = 3000,\n  onClose,\n}: Props): React.ReactElement => {\n  const [classes, setClasses] = useState(styles.box);\n  const ref = useRef<HTMLDivElement>(null);\n\n  function exit(): void {\n    setClasses((): string => `${styles.box} ${styles.exit}`);\n  }\n\n  useEffect((): NoArgsReturnVoidFunction => {\n    // force a repaint\n    /* eslint-disable no-unused-expressions */\n    ref.current && ref.current.scrollTop;\n    /* eslint-disable no-unused-expressions */\n    setClasses((prev): string => `${prev} ${styles.enter}`);\n    const key = eventManager.subscribe('exit', exit);\n\n    return (): void => {\n      eventManager.unSubscribe('exit', key);\n      window.clearTimeout(timerId); // in case toast unmount before reaching the timeout\n    };\n  }, []);\n\n  const scheduleExit = debounce((): void => {\n    timerId = window.setTimeout(exit, duration);\n  });\n\n  return (\n    <div className={styles.mask}>\n      <div\n        className={classes}\n        style={type === 'info' ? undefined : { padding: 15, borderRadius: 5 }}\n        onTransitionEnd={(): void => {\n          // enter phase\n          if (~classes.indexOf(styles.enter) && duration !== 0) {\n            scheduleExit();\n          }\n\n          // exit phase\n          if (~classes.indexOf(styles.exit)) {\n            onClose();\n          }\n        }}\n        ref={ref}\n      >\n        {type !== 'info' && (\n          <div\n            className={styles.wrapper}\n            style={type === 'loading' ? { marginBottom: 10 } : undefined}\n          >\n            <Icon type={type}></Icon>\n          </div>\n        )}\n        <span className={styles.message}>{content}</span>\n      </div>\n    </div>\n  );\n};\n\nexport default Toast;\n","import React from 'react';\nimport ReactDOM from 'react-dom';\nimport { Type, NoArgsReturnVoidFunction } from './types';\nimport eventManager from './event-manager';\nimport Toast from './toast';\n\ninterface Message {\n  type: Type;\n  content: string;\n  duration?: number;\n  onClose?: NoArgsReturnVoidFunction;\n}\n\n// save messages in a queue, only remove it when component lifecycle ends\nconst messages: Message[] = [];\n\neventManager.subscribe('popmessage', (): void => {\n  const { type, content, duration, onClose } = messages[0];\n  const container = document.createElement('div');\n  document.body.appendChild(container);\n  ReactDOM.render(\n    <Toast\n      type={type}\n      content={content}\n      duration={duration}\n      onClose={(): void => {\n        ReactDOM.unmountComponentAtNode(container);\n        document.body.removeChild(container);\n        onClose && onClose();\n        messages.shift();\n        if (messages.length > 0) {\n          eventManager.publish('popmessage');\n        }\n      }}\n    ></Toast>,\n    container\n  );\n});\n\nfunction notice(\n  type: Type,\n  content: string,\n  duration?: number,\n  onClose?: NoArgsReturnVoidFunction\n): void {\n  messages.push({ type, content, duration, onClose });\n  if (messages.length === 1) {\n    eventManager.publish('popmessage');\n  }\n  // if current message is loading, then we should unmount it to proceed\n  if (messages.length > 1 && messages[0].type === 'loading') {\n    eventManager.publish('exit');\n  }\n}\n\nexport default {\n  info(\n    content: string,\n    duration?: number,\n    onClose?: NoArgsReturnVoidFunction\n  ): void {\n    notice('info', content, duration, onClose);\n  },\n  success(\n    content: string,\n    duration?: number,\n    onClose?: NoArgsReturnVoidFunction\n  ): void {\n    notice('success', content, duration, onClose);\n  },\n  fail(\n    content: string,\n    duration?: number,\n    onClose?: NoArgsReturnVoidFunction\n  ): void {\n    notice('fail', content, duration, onClose);\n  },\n  loading(content: string, onClose?: NoArgsReturnVoidFunction): void {\n    notice('loading', content, 0, onClose);\n  },\n  hide(): void {\n    if (messages.length > 0) {\n      eventManager.publish('exit');\n    }\n  },\n};\n"]},"metadata":{},"sourceType":"module"}